<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì - ì¹´í˜ ê´€ë¦¬</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <!-- âœ… ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav>
        <div class="logo">
            <a href="/"><h1>â˜• Cafe & Wifi API</h1></a>
        </div>
        <ul class="nav-links">
            <li><a href="/">í™ˆ</a></li>
            <li><a href="/add">ì¹´í˜ ì¶”ê°€</a></li>
            <li><a href="/update">ì •ë³´ ìˆ˜ì • ìš”ì²­</a></li>
            <li><a href="/admin">ì •ë³´ ìš”ì²­ ìŠ¹ë½/ê±°ë¶€</a></li>
        </ul>
    </nav>

    <!-- âœ… ê´€ë¦¬ì í˜ì´ì§€ ì œëª© -->
    <h2 class="admin-title">ê´€ë¦¬ì í˜ì´ì§€ - ì¹´í˜ ëª©ë¡</h2>

    <!-- âœ… ê´€ë¦¬ì í…Œì´ë¸” -->
    <div class="admin-table-container">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ì¹´í˜ ID</th>
                    <th>ì¹´í˜ ì´ë¦„</th>
                    <th>ìœ„ì¹˜</th>
                    <th>ì»¤í”¼ ê°€ê²©</th>
                    <th>ì‚­ì œ</th>
                </tr>
            </thead>
            <tbody id="cafes-table-body"></tbody>
        </table>
    </div>

    <script>
        async function loadCafeList() {

            const response = await fetch("/admin/cafes", {
                method: "GET",
                credentials: "include"
            });

            if (response.status === 403) {
                alert("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
                window.location.href = "/login";
                return;
            }

            const cafes = await response.json();
            const tbody = document.getElementById("cafes-table-body");
            tbody.innerHTML = ""; // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”

            cafes.forEach(cafe => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${cafe.id}</td>
                    <td>${cafe.name}</td>
                    <td>${cafe.location}</td>
                    <td>${cafe.coffee_price || "ì •ë³´ ì—†ìŒ"}</td>
                    <td><button onclick="deleteCafe(${cafe.id})">ğŸ—‘ ì‚­ì œ</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        async function deleteCafe(cafeId) {

            const confirmDelete = confirm("ì •ë§ë¡œ ì´ ì¹´í˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê´€ë ¨ëœ ìˆ˜ì • ìš”ì²­ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.");
            if (!confirmDelete) return;

            const response = await fetch(`/cafes/${cafeId}`, {
                method: "DELETE",
                credentials: "include"
            });

            if (response.status === 200) {
                alert("ì¹´í˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                location.reload();
            } else {
                const errorData = await response.json();
                alert("ì‚­ì œ ì‹¤íŒ¨: " + errorData.error);
            }
        }

        window.onload = loadCafeList;
    </script>
</body>
</html>
